- hosts: bastion
  vars:
    temp_dir: "../gi-temp"
    registry_version: "2.7.1"
    matchbox_version: "v0.9.0"
    internet_type:  "{{ lookup('env','GI_INTERNET_ACCESS') }}"
    domain:  "{{ lookup('env','GI_DOMAIN') }}"
    install_ldap:  "{{ lookup('env','GI_INSTALL_LDAP') }}"
    ssh_key:  "{{ lookup('env','GI_SSH_KEY') }}"



  tasks:
    - name: Check standard configuration parameters
      fail: msg="Variable {{ item.name }} is not set"
      when: item.value == ""
      loop:
        - { name: "GI_INTERNET_ACCESS", value: "{{ internet_type }}" }
        - { name: "GI_DOMAIN", value: "{{ domain }}" }
        - { name: "GI_INSTALL_LDAP", value: "{{ install_ldap }}" }
        - { name: "GI_SSH_KEY", value: "{{ ssh_key }}" }

    - name: Set parameters for air-gapped installation
      set_fact:
        archives_dir:  "{{ lookup('env','GI_ARCHIVES_DIR') }}"
        repo_user:  "{{ lookup('env','GI_REPO_USER') }}"
        repo_user_password:  "{{ lookup('env','GI_REPO_USER_PWD') }}"
      when: internet_type == 'A'

    - name: Check configuration parameters for air-gapped installation
      fail: msg="Variable {{ item.name }} is not set"
      when: internet_type == 'A' and item.value == ""
      loop:
        - { name: "GI_REPO_USER", value: "{{ repo_user }}" }
        - { name: "GI_REPO_USER_PWD", value: "{{ repo_user_password }}" }
        - { name: "GI_ARCHIVES_DIR", value: "{{ archives_dir }}" }

          
    - name: Setup bastion
      include: setup_bastion.yaml
